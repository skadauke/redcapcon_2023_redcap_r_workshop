---
title: "Extracting and Exploring REDCap Data in R"
format: html
editor: visual
---

## Extracting Data from REDCap using REDCapR

For the first 10 min, we will download REDCap data using [REDCapR](https://ouhscbbmc.github.io/REDCapR).


### Install latest version of REDCapR

Let's install with the newest version of REDCapR from GitHub.

```{r}
if (packageVersion("REDCapR") < "1.1.9005") {
  install.packages("remotes")
  remotes::install_github("OuhscBbmc/REDCapR")
}
```

### Retrieve Secure Token

We'll discuss tokens in more depth at the end of the workshop.
For now, know that a "token" is a secret value that serves as your personal password to a specific REDCap project.

```{r}
path_credential <- "../data-private/credentials.csv"
# path_credential <- "redcapcon_2023_redcap_r_workshop/data-private/credentials.csv"
credential  <- REDCapR::retrieve_credential_local(path_credential, 1L)
credential
```

### Peek at Variables, Events, & Instruments

Here's a project of fake data that Stephan created to mimic the CAR-T investigation.
The first snippet reveals info from the 368 variables.  
The second reveals info about the combinations of events & instruments.

```{r}
REDCapR::redcap_metadata_read(
  redcap_uri  = credential$redcap_uri,
  token       = credential$token
)$data

REDCapR::redcap_event_instruments(
  redcap_uri  = credential$redcap_uri,
  token       = credential$token
)$data
```

If important details are obscured, 
use `View()` to see things in a nice scrollable table inside RStudio:

```r
View(REDCapR::redcap_metadata_read(
  redcap_uri  = credential$redcap_uri,
  token       = credential$token
)$data)
```

## Exploring the REDCapTidieR Supertibble

Take a look at the *Environments* pane to the right. Note that there is an object named `redcart`. This is the **supertibble** you just created inside of R's memory. (If you don't see `redcart`, try running the code chunk above again).

A **tibble** (or **data frame**) is a tabular data structure with rows and columns. A **supertibble** is a tibble that contains tibbles.

On the far right next to `redcart`, you will spot an icon that looks like a small table. Click on it to make the *Data Viewer* appear.

The *Data Viewer* is built into the Posit IDE as a handy as to explore data tables.

Go ahead an explore `redcart` to confirm the following features of the supertibble:

1.  Each row represents a REDCap instrument.
2.  In addition to the instrument's name, useful instrument-level metadata is shown here.
3.  The `redcap_data` column contains tibbles (note the little table icons!)
4.  By clicking on a tibble object inside the `redcap_data` column you can *drill down* and view the data stored in a specific REDCap instrument.

Without writing any code, just by working with the *Data Viewer*, try to answer the following questions:

1.  How many instruments are in the `redcart` database?

2.  How many rows are in the `demographics` table?

3.  Is the `consent` instrument repeating or nonrepeating? How can you tell? Why or why not?

4.  Drill down into the `demographics` instrument. How many patients are captured in here? Who is the oldest patient on the trial?

Studies have shown that explaining material you just learned to others can boost memory. So if you're done early, you might want to get up and help out others! :)
